<div class="fetch">
  <div class="fetch__wrapper">
    <!-- Page Header -->
    <div class="fetch__header">
      <div class="fetch__header-content">
        <h1 class="fetch__title">Fetch Research Papers</h1>
        <p class="fetch__subtitle">
          Select a category and the number of results to start your search.
        </p>
      </div>
    </div>

    <!-- Controls Section -->
    <div class="fetch__controls">
      <!-- Category Dropdown -->
      <div class="fetch__control-group">
        <label class="fetch__label" for="category">Research Category</label>
        <select 
          id="category"
          class="fetch__select" 
          [(ngModel)]="selectedCategory"
        >
          <option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </option>
        </select>
      </div>

      <!-- Slider -->
      <div class="fetch__control-group fetch__control-group--slider">
        <div class="fetch__slider-header">
          <label class="fetch__label">Number of Results</label>
          <span class="fetch__slider-value">{{ numberOfResults }}</span>
        </div>
        <div class="fetch__slider-container">
          <input 
            type="range" 
            class="fetch__slider"
            min="1" 
            max="100" 
            [value]="numberOfResults"
            (input)="onSliderChange($event)"
            [style.--slider-percentage]="sliderPercentage + '%'"
          />
        </div>
      </div>

      <!-- Fetch Button -->
      <button class="fetch__button" (click)="fetchPapers()">
        <span class="material-symbols-outlined">search</span>
        <span>Fetch Papers</span>
      </button>
    </div>

    <!-- Results Grid -->
    <div class="fetch__results">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="fetch__grid">
        <div *ngFor="let item of loadingPapers" class="paper-card paper-card--loading">
          <div class="paper-card__skeleton">
            <div class="skeleton skeleton--title"></div>
            <div class="skeleton skeleton--subtitle"></div>
          </div>
          <div class="paper-card__skeleton-content">
            <div class="skeleton skeleton--line"></div>
            <div class="skeleton skeleton--line skeleton--line-short"></div>
          </div>
          <div class="paper-card__skeleton-actions">
            <div class="skeleton skeleton--button"></div>
            <div class="skeleton skeleton--button"></div>
          </div>
        </div>
      </div>

      <!-- Papers Grid -->
      <div *ngIf="!isLoading && !showEmptyState && !hasError" class="fetch__grid">
        <div *ngFor="let paper of papers" class="paper-card">
          <div class="paper-card__header">
            <h3 class="paper-card__title">{{ paper.title }}</h3>
            <div class="paper-card__meta">
              <span>{{ paper.authors }}</span>
              <span class="paper-card__separator">|</span>
              <span>Published: {{ paper.publishedDate }}</span>
            </div>
          </div>
          
          <p class="paper-card__summary">{{ paper.summary }}</p>
          
          <div class="paper-card__actions">
            <button class="paper-card__button paper-card__button--primary" (click)="analyzeAndSave(paper.id)">
              <span class="material-symbols-outlined">auto_awesome</span>
              <span>Analyze & Save</span>
            </button>
            <button class="paper-card__button paper-card__button--secondary" (click)="openPDF(paper.id)">
              <span class="material-symbols-outlined">picture_as_pdf</span>
              <span>Open PDF</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="showEmptyState && !isLoading && !hasError" class="fetch__empty-state">
        <div class="empty-state">
          <div class="empty-state__icon">
            <span class="material-symbols-outlined">search</span>
          </div>
          <div class="empty-state__content">
            <p class="empty-state__title">Start Your Research</p>
            <p class="empty-state__description">
              Select a category and specify the number of results, then click "Fetch Papers" to begin discovering new insights.
            </p>
          </div>
        </div>
      </div>

      <!-- Error State -->
      <div *ngIf="hasError && !isLoading" class="fetch__error">
        <div class="error-state">
          <span class="material-symbols-outlined error-state__icon">error</span>
          <div class="error-state__content">
            <p class="error-state__title">Failed to fetch papers.</p>
            <p class="error-state__description">Please check your connection and try again.</p>
          </div>
          <button class="error-state__button" (click)="retryFetch()">
            Try Again
          </button>
        </div>
      </div>
      <!-- Fullscreen Loader -->
<div class="loader-overlay" *ngIf="isAnalyzing">
  <div class="loader-box">
    <div class="loader-text">Analyzing Paper...</div>

    <div class="progress-container">
      <div class="progress-bar" [style.width.%]="progress"></div>
    </div>

    <div class="progress-value">{{ progress }}%</div>
  </div>
</div>

    </div>
  </div>
</div>